"use strict";
let uploadProgress=[];var $next3={keys:{},init:function(){$next3.loadFiles();let e=document.querySelector(".dashicons.backicon");e&&(e.removeEventListener("click",$next3.backLoad),e.addEventListener("click",$next3.backLoad));let t=document.querySelector(".dashicons.nexticon");t&&(t.removeEventListener("click",$next3.nextLoad),t.addEventListener("click",$next3.nextLoad));let i=document.querySelector(".dashicons.refreshicon");i&&(i.removeEventListener("click",$next3.refrashLoad),i.addEventListener("click",$next3.refrashLoad));let s=document.querySelectorAll(".next3-listitem");s&&s.forEach(function(e){e.removeEventListener("click",$next3.listGridLoad),e.addEventListener("click",$next3.listGridLoad)});var n=document.querySelector("#next3-add-bucket");n&&(n.removeEventListener("click",$next3.newCreateBucket),n.addEventListener("click",$next3.newCreateBucket));let l=document.querySelector("#media-search-input");l&&(l.removeEventListener("keyup",$next3.searchFilterFiles),l.addEventListener("keyup",$next3.searchFilterFiles),l.removeEventListener("blur",$next3.searchFilterFiles),l.addEventListener("blur",$next3.searchFilterFiles))},loadFiles:function(){if(nJs){let e=document.querySelector(".n3content-file");if(e){e.getAttribute("keys")||e.setAttribute("keys",""),t=e.getAttribute("keys"),e.getAttribute("store")||e.setAttribute("store",""),i=e.getAttribute("store"),e.getAttribute("refresh")||e.setAttribute("refresh",1),s=e.getAttribute("refresh");var t,i,s,n=document.querySelector("ul.append-nx3-media");if(!n)return;n.innerHTML="Loading...",$next3.actionButtonAll();let l="";if(""!=t){t=JSON.parse(t);let r=[];for(let a in t)r.push(t[a]);l=r.join("/")}nJs.ajax({action:window.nxaws3.resturl+"next3/v1/manage",method:"GET",header:{"X-WP-Nonce":window.nxaws3.nonce,"Content-Type":"application/json"},data:{id:i,keys:l,refresh:s}}).onload=function(){if(4==this.readyState&&200==this.status){var t=nJs.strToJson(this.response);let i=document.querySelector(".dashicons.refreshicon");if(i&&i.removeAttribute("style"),t.error){n.innerHTML=t.message;return}if(t.store&&e.setAttribute("store",t.store),t.store_list&&null!=t.store_list&&!t.files){var s=t.store_list;for(let l in s)nJs.el(n,"li",{class:"aws-li "+l,id:l,trigger:{click:$next3.actionBuckets}},[{child:["span",{class:"dashicons dashicons-admin-site-alt2"}]},{child:["span",{content:s[l]}]}])}if(t.files&&""!=t.files){n.innerHTML="",$next3.renderUploader(n);var r=t.files;for(let a in r)if(r[a]&&null!=r[a]){if("folder"==r[a].type)nJs.el(n,"li",{class:"aws-li "+r[a].link,id:r[a].link,trigger:{click:$next3.actionFolder}},[{child:["span",{class:r[a].htl}]},{child:["span",{innerHTML:r[a].name}]}]);else{if(r[a].is_image)var o='<div class="attachment-preview"><div class="thumbnail"><div class="centered"><img src="'+r[a].htl+'" alt="'+r[a].name+'"><span class="file-title">'+r[a].name+'</span> <span class="file-title file-size">'+r[a].size_byte+"</span></div></div></div>";else var o='<span class="'+r[a].htl+'"></span><span class="file-title">'+r[a].name+'</span><span class="file-title file-size">'+r[a].size_byte+"</span>";let c=nJs.el(n,"li",{class:"aws-li files-data ","data-link":r[a].link,"data-path":r[a].path_key,innerHTML:o},[{child:["div",{class:"next3-title-overview"},[{child:["span",{class:"file-title",innerText:r[a].name}]},{child:["span",{class:"file-size",innerText:"["+r[a].size_byte+"]"}]}]]}]);$next3.addItemIntoFiles(c);var d=document.querySelector(".aws-files-uploader-action");d&&""==r[a].link&&d.setAttribute("style","display: block;")}}}else if(""!=t.store){$next3.renderUploader(n),n.querySelectorAll(".aws-li").forEach(function(e){e.setAttribute("style","display: none;")});var d=document.querySelector(".aws-files-uploader-action");d&&d.setAttribute("style","display: block;")}e.setAttribute("refresh",1)}else n.innerHTML="Server Error!!"}}}},actionBuckets:function(e){e.preventDefault();let t=document.querySelector(".n3content-file");if(t){var i=this.getAttribute("id");t.setAttribute("store",i),$next3.loadFiles()}},actionFolder:function(e){e.preventDefault();var t=this.getAttribute("id");let i=document.querySelector(".n3content-file");if(document.querySelector(".dashicons.nexticon"),i){var s=i.getAttribute("keys");if(s&&""!=s){let n=JSON.parse(s);(n=Object.values(n))&&(n.push(t),n=Object.assign({},n),i.setAttribute("keys",JSON.stringify(n)),$next3.keys=n)}else{var l={0:t};i.setAttribute("keys",JSON.stringify(l)),$next3.keys=l}$next3.loadFiles()}let r=document.getElementById("nxprogress-bar");r&&(r.outerHTML="")},renderUploader:function(e){var t=document.querySelector("#next3-add-files");t&&(t.setAttribute("style","display: inline-block;"),t.removeEventListener("click",$next3.openUploader),t.addEventListener("click",$next3.openUploader));var i=document.querySelector("#next3-add-folder");i&&(i.setAttribute("style","display: inline-block;"),i.removeEventListener("click",$next3.newFolderCreate),i.addEventListener("click",$next3.newFolderCreate)),nJs.el(e,"li",{class:"aws-files-uploader-action",trigger:{drop:$next3.fileUploadDrop,dragleave:$next3.fileUploadDrop,dragenter:$next3.fileUploadOver,dragover:$next3.fileUploadOver}},[{child:["form",{action:"",class:"aws-uploder-forms-pop",method:"post",enctype:"multipart/form-data"},[{child:["button",{class:"close dashicons dashicons-no",type:"button",trigger:{click:$next3.closeUploader}},[{child:["span",{class:"screen-reader-text",innerHTML:"Close uploader"}]}]]},{child:["h2",{class:"upload-instructions drop-instructions",content:"Drop files to upload"}]},{child:["p",{class:"upload-instructions drop-instructions",content:"or"}]},{child:["input",{type:"file",multiple:!0,name:"file",trigger:{change:$next3.fileUpload}}]},{child:["button",{type:"button",class:"browser button button-hero",style:"position: relative; z-index: 1;",innerHTML:"Select Files"}]}]]}])},actionButtonAll:function(){let e=document.querySelector(".n3content-file");if(e){if(e.getAttribute("store").trim().toString().length>0){var t=document.querySelector("#next3-add-files");t&&t.setAttribute("style","display: inline-block;");var i=document.querySelector("#next3-add-folder");i&&i.setAttribute("style","display: inline-block;");var s=document.querySelector("#next3-add-bucket");s&&s.setAttribute("style","display: none;")}else{var s=document.querySelector("#next3-add-bucket");s&&s.setAttribute("style","display: inline-block;");var t=document.querySelector("#next3-add-files");t&&t.setAttribute("style","display: none;");var i=document.querySelector("#next3-add-folder");i&&i.setAttribute("style","display: none;")}}},openUploader:function(e){e.preventDefault();var t=document.querySelector(".aws-files-uploader-action");t&&t.setAttribute("style","display: block;")},newFolderCreate:function(e){e.preventDefault();var t=prompt("Create New folder","New Folder");if(null!=t){let i=t.toLowerCase().replace(/\s|_/g,"-").replace(/\//g,"");var s=document.querySelector("ul.append-nx3-media");if(!s)return;nJs.el(s,"li",{class:"aws-li "+i,id:i,trigger:{click:$next3.actionFolder}},[{child:["span",{class:"dashicons dashicons-book"}]},{child:["span",{innerHTML:t}]}],1)}},newCreateBucket:function(e){e.preventDefault();var t=prompt("Create New buckets","new-bucket");if(null!=t){t=t.toLowerCase().replace(/\s|_/g,"-").replace(/\//g,"");var i=document.querySelector("ul.append-nx3-media");if(!i)return;nJs.ajax({action:window.nxaws3.resturl+"next3/v1/buckets",method:"POST",header:{"X-WP-Nonce":window.nxaws3.nonce,"Content-Type":"application/json"},data:{id:t}}).onload=function(){if(4==this.readyState&&200==this.status){var e=nJs.strToJson(this.response);if(e.error){alert(e.message);return}if(e.success){nJs.el(i,"li",{class:"aws-li "+e.message,id:e.message,trigger:{click:$next3.actionBuckets}},[{child:["span",{class:"dashicons dashicons-admin-site-alt2"}]},{child:["span",{content:e.message}]}]);let t=document.querySelector(".n3content-file");t&&t.setAttribute("refresh",0)}}}}},addMediaFile:function(e){e.preventDefault();var t=this,i=t.parentElement.parentElement.getAttribute("data-link"),s=t.parentElement.parentElement.getAttribute("data-path");confirm("Are you want to use this file into wp media?")&&(nJs.ajax({action:window.nxaws3.resturl+"next3/v1/save",method:"GET",header:{"X-WP-Nonce":window.nxaws3.nonce,"Content-Type":"application/json"},data:{url:i,path:s}}).onload=function(){if(4==this.readyState&&200==this.status){var e=nJs.strToJson(this.response);if(e.error){alert(e.message);return}t.classList.remove("dashicons-plus-alt2"),t.classList.add("dashicons-yes"),t.removeEventListener("click",$next3.addMediaFile)}})},deleteMediaFile:function(e){e.preventDefault();var t=this,i=t.parentElement.parentElement,s=i.getAttribute("data-path");let n=document.querySelector(".n3content-file");if(!n){alert("Invalid request!!");return}var l=n.getAttribute("store").trim().toString();confirm("Are you want to delete this file?")&&(t.style.opacity=.4,t.style.pointerEvents="none",nJs.ajax({action:window.nxaws3.resturl+"next3/v1/deletes",method:"POST",header:{"X-WP-Nonce":window.nxaws3.nonce},data:{id:l,path:s}}).onload=function(){if(4==this.readyState&&200==this.status){var e=nJs.strToJson(this.response);if(e.error){alert(e.message);return}i.outerHTML="",t.removeEventListener("click",$next3.deleteMediaFile),n.setAttribute("refresh",0)}})},copyMediaFile:function(e){e.preventDefault();let t=this.parentElement.parentElement.getAttribute("data-link"),i=this.parentElement,s=i.querySelector(".nxlink-copy-text");if(!s){let n=document.createElement("input");n.setAttribute("class","nxlink-copy-text"),n.setAttribute("type","text"),n.setAttribute("style","opacity: 0; left:0; position: absolute;user-select: none;pointer-events: none;"),n.setAttribute("value",t),i.appendChild(n),s=i.querySelector(".nxlink-copy-text")}s.select(),s.setSelectionRange(0,99999),document.execCommand("copy"),this.setAttribute("class","dashicons dashicons-editor-unlink nxlink-copy")},backLoad:function(e){e.preventDefault();let t=document.querySelector(".n3content-file"),i=document.querySelector(".dashicons.nexticon");if(t){let s=t.getAttribute("keys");if(s&&""!=s){let n=JSON.parse(s),l=[];if(Object.entries(n))for(let[r,a]of Object.entries(n))l.push(a);if(l.length>0){let o=l.length-1,c=l[o]?l[o]:"";t.setAttribute("last-keys",c),l.pop(),l=Object.assign({},l),t.setAttribute("keys",JSON.stringify(l)),$next3.keys=l,i&&i.classList.add("nxicon-open")}else t.setAttribute("keys",""),t.setAttribute("store",""),i&&(i.classList.remove("nxicon-open"),t.removeAttribute("last-keys"))}else t.setAttribute("keys",""),t.setAttribute("store",""),i&&(i.classList.remove("nxicon-open"),t.removeAttribute("last-keys"));$next3.loadFiles()}},nextLoad:function(e){e.preventDefault();let t=document.querySelector(".n3content-file");if(t){let i=t.getAttribute("keys");if(i&&""!=i){let s=JSON.parse(i),n=[];if(Object.entries(s))for(let[l,r]of Object.entries(s))n.push(r);let a=t.getAttribute("last-keys");a&&""!=a&&(n.push(a),n=Object.assign({},n),t.setAttribute("keys",JSON.stringify(n)),$next3.keys=n),t.removeAttribute("last-keys"),this.classList.remove("nxicon-open"),$next3.loadFiles()}}},refrashLoad:function(e){e.preventDefault();let t=document.querySelector(".n3content-file");t&&(this.setAttribute("style","pointer-events: none;"),t.setAttribute("refresh",0),$next3.loadFiles())},listGridLoad:function(e){e.preventDefault();var t=document.querySelector("ul.append-nx3-media");if(t){let i=this.getAttribute("data-id"),s=document.querySelectorAll(".next3-listitem");s&&s.forEach(function(e){e.parentElement.classList.remove("nx3-active")}),"list"==i?t.classList.add("nxlist-view"):t.classList.remove("nxlist-view"),this.parentElement.classList.add("nx3-active")}},closeUploader:function(e){e.preventDefault();var t=document.querySelector(".aws-files-uploader-action");t&&t.setAttribute("style","display: none;")},fileUploadDrop:function(e){e.stopPropagation(),e.preventDefault(),this.classList.remove("highlight");let t=e.dataTransfer,i=t.files;$next3.handleFiles(i)},fileUploadOver:function(e){e.preventDefault(),e.stopPropagation(),this.classList.add("highlight")},fileUpload:function(e){e.stopPropagation(),$next3.handleFiles(this.files)},handleFiles:function(e){if(0==e.length)return;let t=document.querySelector("ul.append-nx3-media");if(t){let i=document.getElementById("nxprogress-bar");i&&(i.outerHTML=""),nJs.el(t,"progress",{class:"nxprogress-bar",id:"nxprogress-bar",max:e.length,value:0},[],0)}var s,n,l,r=new FormData;for(let a in e)r.append("file[]",e[a]);let o=document.querySelector(".n3content-file");o&&(o.getAttribute("keys")||o.setAttribute("keys",""),s=o.getAttribute("keys"),o.getAttribute("store")||o.setAttribute("store",""),n=o.getAttribute("store"),o.getAttribute("refresh")||o.setAttribute("refresh",1),l=o.getAttribute("refresh"),r.append("action","next3_uploadsfiles"),r.append("security",window.nxaws3.uploadnonce),r.append("id",n),r.append("keys",s),r.append("refresh",l),jQuery.ajax({url:window.nxaws3.ajax_url,type:"POST",contentType:!1,processData:!1,data:r,success:function(t){if(!t.success){alert(t.data);return}if(t.success&&t.data.files){var i=t.data.files?t.data.files:[];if(i.length>0){var s=0;i.forEach(t=>{if($next3.updateProgress(s,100*s/e.length||100),t.is_image)var i='<div class="attachment-preview"><div class="thumbnail"><div class="centered"><img src="'+t.htl+'" alt="'+t.name+'"><span class="file-title">'+t.name+'</span> <span class="file-title file-size">'+t.size_byte+"</span></div></div></div>";else var i='<span class="'+t.htl+'"></span>';var n=document.querySelector("ul.append-nx3-media");if(!n)return;let l=nJs.el(n,"li",{class:"aws-li files-data ","data-link":t.link,"data-path":t.path_key,innerHTML:i},[{child:["div",{class:"next3-title-overview"},[{child:["span",{class:"file-title",innerText:t.name}]},{child:["span",{class:"file-size",innerText:"["+t.size_byte+"]"}]}]]}],2);$next3.addItemIntoFiles(l),s++}),o&&o.setAttribute("refresh",0)}}}}),$next3.initializeProgress(e.length))},previewFile:function(e,t){var i=document.querySelector("ul.append-nx3-media");if(!i||!e.name||""==e.name)return;var s=e.type,n=RegExp("image/");let l=new FileReader;l.readAsDataURL(e),l.onloadend=function(){if(e.type&&n.test(s))var r='<div class="attachment-preview"><div class="thumbnail"><div class="centered"><img src="'+l.result+'" alt="'+e.name+'"><span class="file-title">'+e.name+"</span></div></div></div>";else var r='<span class="dashicons dashicons-media-archive"></span><span class="file-title">'+e.name+"</span>";nJs.el(i,"li",{class:"aws-li files-data ","data-link":"",id:"awsupload-"+t,trigger:{click:$next3.addMediaFile},innerHTML:r},[],2)}},initializeProgress:function(e){let t=document.getElementById("nxprogress-bar");if(t){t.value=0,uploadProgress=[];for(let i=e;i>0;i--)uploadProgress.push(0)}},updateProgress:function(e,t){let i=document.getElementById("nxprogress-bar");if(!i)return;uploadProgress[e]=t;let s=uploadProgress.reduce((e,t)=>e+t,0)/uploadProgress.length;i.value=s},searchFilterFiles:function(e){e.preventDefault();let t=this.value.toUpperCase();var i=document.querySelector("ul.append-nx3-media");if(!i)return;let s=i.getElementsByTagName("li");if(s)for(let n=0;n<s.length;n++){let l=s[n].querySelectorAll("*");if(l){let r="";l.forEach(function(e){r+=e.textContent||e.innerText+" "}),r.toUpperCase().indexOf(t)>-1?s[n].style.display="":s[n].style.display="none"}}},addItemIntoFiles:function(e){e&&nJs.el(e,"div",{class:"next3-action-overview"},[{child:["span",{class:"dashicons dashicons-admin-links nxlink-copy",title:"Copy link",trigger:{click:$next3.copyMediaFile}}]},{child:["span",{class:"dashicons dashicons-plus-alt2 nxlink-add",title:"Add WP Media",trigger:{click:$next3.addMediaFile}}]},{child:["span",{class:"dashicons dashicons-trash nxlink-delete",title:"Delete File",trigger:{click:$next3.deleteMediaFile}}]}])}};$next3.init();