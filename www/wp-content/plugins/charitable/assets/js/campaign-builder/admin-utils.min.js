var wpchar={cachedFields:{},savedState:!1,initialSave:!0,orders:{fields:[],choices:{}},init:function(){wpchar.bindUIActions(),wpchar.initRadioGroupForCheckboxes(),jQuery(wpchar.ready)},ready:function(){wpchar.savedState=wpchar.getFormState("#charitable-builder-form"),wpchar.setFieldOrders(),wpchar.setChoicesOrders()},bindUIActions:function(){jQuery(document).on("charitableFieldAdd",wpchar.setFieldOrders),jQuery(document).on("charitableFieldDelete",wpchar.setFieldOrders),jQuery(document).on("charitableFieldMove",wpchar.setFieldOrders),jQuery(document).on("charitableFieldAdd",wpchar.setChoicesOrders),jQuery(document).on("charitableFieldChoiceAdd",wpchar.setChoicesOrders),jQuery(document).on("charitableFieldChoiceDelete",wpchar.setChoicesOrders),jQuery(document).on("charitableFieldChoiceMove",wpchar.setChoicesOrders),jQuery(document).on("charitableFieldAdd",wpchar.fieldUpdate),jQuery(document).on("charitableFieldDelete",wpchar.fieldUpdate),jQuery(document).on("charitableFieldMove",wpchar.fieldUpdate),jQuery(document).on("focusout",".charitable-field-option-row-label input",wpchar.fieldUpdate),jQuery(document).on("charitableFieldChoiceAdd",wpchar.fieldUpdate),jQuery(document).on("charitableFieldChoiceDelete",wpchar.fieldUpdate),jQuery(document).on("charitableFieldChoiceMove",wpchar.fieldUpdate),jQuery(document).on("charitableFieldDynamicChoiceToggle",wpchar.fieldUpdate),jQuery(document).on("focusout",".charitable-field-option-row-choices input.label",wpchar.fieldUpdate)},setFieldOrders:function(){wpchar.orders.fields=[],jQuery(".charitable-field-option").each((function(){wpchar.orders.fields.push(jQuery(this).data("field-id"))}))},setChoicesOrders:function(){wpchar.orders.choices={},jQuery(".choices-list").each((function(){var e=jQuery(this).data("field-id");wpchar.orders.choices["field_"+e]=[],jQuery(this).find("li").each((function(){wpchar.orders.choices["field_"+e].push(jQuery(this).data("key"))}))}))},getChoicesOrder:function(e){var r=[];return jQuery("#charitable-field-option-"+e).find(".choices-list li").each((function(){r.push(jQuery(this).data("key"))})),r},initMultipleSelectWithSearch:function(e){const r=jQuery(e.passedElement.element),t=jQuery(e.input.element);r.prop("multiple")&&(t.data("placeholder",t.attr("placeholder")),e.getValue(!0).length&&t.removeAttr("placeholder"),r.on("change",(function(){e.getValue(!0).length?t.removeAttr("placeholder"):t.attr("placeholder",t.data("placeholder"))})))},fieldUpdate:function(){var e=wpchar.getFields();jQuery(document).trigger("charitableFieldUpdate",[e]),wpchar.debug("fieldUpdate triggered")},getFields:function(e,r){if(t=!1,(r=r||!1)&&!jQuery.isEmptyObject(wpchar.cachedFields))t=jQuery.extend({},wpchar.cachedFields),wpchar.debug("getFields triggered (cached)");else{var t=wpchar.formObject("#charitable-field-options").fields,i=["captcha","content","divider","entry-preview","html","internal-information","layout","pagebreak"];if(!t)return!1;for(var a in t)(!t[a].type||jQuery.inArray(t[a].type,i)>-1)&&delete t[a];wpchar.cachedFields=jQuery.extend({},t),wpchar.debug("getFields triggered")}if(e&&e.constructor===Array)for(var a in t)-1===jQuery.inArray(t[a].type,e)&&delete t[a];return t},getField:function(e){var r=wpchar.formObject("#charitable-field-option-"+e);return r.fields[Object.keys(r.fields)[0]]},fieldOptionLoading:function(e,r){var t=jQuery(e),i=t.find("label");(r=void 0!==r)?(i.find(".charitable-loading-spinner").remove(),i.find(".charitable-help-tooltip").show(),t.find("input,select,textarea").prop("disabled",!1)):(i.append('<i class="charitable-loading-spinner charitable-loading-inline"></i>'),i.find(".charitable-help-tooltip").hide(),t.find("input,select,textarea").prop("disabled",!0))},getFormState:function(e){return jQuery(e).serialize()},removeArrayItem:function(e,r){for(var t=0,i=0;i<e.length;i++)e[i]===r&&(e.splice(i,1),t++,i--);return t},sanitizeString:function(e){return"string"==typeof e||e instanceof String?e.trim():e},updateQueryString:function(e,r,t){t||(t=window.location.href);var i,a=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(a.test(t))return null!=r?t.replace(a,"$1"+e+"="+r+"$2$3"):(i=t.split("#"),t=i[0].replace(a,"$1$3").replace(/(&|\?)$/,""),void 0!==i[1]&&null!==i[1]&&(t+="#"+i[1]),t);if(null!=r){var n=-1!==t.indexOf("?")?"&":"?";return i=t.split("#"),t=i[0]+n+e+"="+r,void 0!==i[1]&&null!==i[1]&&(t+="#"+i[1]),t}return t},getQueryString:function(e){var r=new RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return r&&decodeURIComponent(r[1].replace(/\+/g," "))},removeQueryParam:function(e){if(wpchar.getQueryString(e)){var r=new RegExp("[\\?&]"+e+"=[^&]+");history.replaceState&&history.replaceState(null,"",location.pathname+location.search.replace(r,"").replace(/^&/,"?")+location.hash)}},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},amountSanitize:function(e){return e=String(e).replace(/[^0-9.,]/g,""),","===charitable_builder.currency_decimal?("."===charitable_builder.currency_thousands&&-1!==e.indexOf(charitable_builder.currency_thousands)?e=e.replace(new RegExp("\\"+charitable_builder.currency_thousands,"g"),""):""===charitable_builder.currency_thousands&&-1!==e.indexOf(".")&&(e=e.replace(/\./g,"")),e=e.replace(charitable_builder.currency_decimal,".")):","===charitable_builder.currency_thousands&&-1!==e.indexOf(charitable_builder.currency_thousands)&&(e=e.replace(new RegExp("\\"+charitable_builder.currency_thousands,"g"),"")),wpchar.numberFormat(e,charitable_builder.currency_decimals,".","")},amountFormat:function(e){if(e=String(e),","===charitable_builder.currency_decimal&&-1!==e.indexOf(charitable_builder.currency_decimal)){var r=e.indexOf(charitable_builder.currency_decimal);e=e.substr(0,r)+"."+e.substr(r+1,e.length-1)}return","===charitable_builder.currency_thousands&&-1!==e.indexOf(charitable_builder.currency_thousands)&&(e=e.replace(/,/g,"")),wpchar.empty(e)&&(e=0),wpchar.numberFormat(e,charitable_builder.currency_decimals,charitable_builder.currency_decimal,charitable_builder.currency_thousands)},amountFormatCurrency:function(e){var r=wpchar.amountSanitize(e),t=wpchar.amountFormat(r);return"right"===charitable_builder.currency_symbol_pos?t+" "+charitable_builder.currency_symbol:charitable_builder.currency_symbol+" "+t},numberFormat:function(e,r,t,i){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var a=isFinite(+e)?+e:0,n=isFinite(+r)?Math.abs(r):0,c=void 0===i?",":i,o=void 0===t?".":t,l="";return l=(n?function(e,r){var t=Math.pow(10,r);return""+(Math.round(e*t)/t).toFixed(r)}(a,n):""+Math.round(a)).split("."),l[0].length>3&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,c)),(l[1]||"").length<n&&(l[1]=l[1]||"",l[1]+=new Array(n-l[1].length+1).join("0")),l.join(o)},empty:function(e){var r,t,i,a=[undefined,null,!1,0,"","0"];for(t=0,i=a.length;t<i;t++)if(e===a[t])return!0;if("object"==typeof e){for(r in e)if(e.hasOwnProperty(r))return!1;return!0}return!1},debug:function(e,r=""){wpchar.isDebug()&&(r&&(r="("+r+")"),console.log("%cCharitable Debug: "+r,"color: #cd6622;",e))},isDebug:function(){return window.location.hash&&"#charitabledebug"===window.location.hash||charitable_builder.debug},focusCaretToEnd:function(e){e.trigger("focus");var r=e.val();e.val("").val(r)},formObject:function(e){for(var r=jQuery(e).find("[name]"),t={},i={},a=0;a<r.length;a++){var n=jQuery(r[a]),c=n.prop("name").replace(/\]/gi,"").split("["),o=n.val(),l={};if(!n.is(":radio")&&!n.is(":checkbox")||n.is(":checked")){for(var d=c.length-1;d>=0;d--){var u=c[d];if(void 0===u&&(u=""),0===u.length&&(l=[],void 0===i[c[d-1]]?i[c[d-1]]=0:i[c[d-1]]+=1,u=i[c[d-1]]),d===c.length-1){if(o)if("true"===o)o=!0;else if("false"===o)o=!1;else if(isNaN(parseFloat(o))||parseFloat(o).toString()!==o)if("string"!=typeof o||"{"!==o.substr(0,1)&&"["!==o.substr(0,1)){if("object"==typeof o&&o.length&&n.is("select")){var p={};for(d=0;d<o.length;d++)p["n"+d]=o[d];o=p}}else try{o=JSON.parse(o)}catch(e){}else o=parseFloat(o);l[u]=o}else{var s=l;(l={})[u]=s}}jQuery.extend(!0,t,l)}}return t},initTooltips:function(){void 0!==jQuery.fn.tooltipster&&jQuery(".charitable-help-tooltip").tooltipster({contentAsHTML:!0,position:"right",maxWidth:300,multiple:!0,interactive:!0,debug:!1,IEmin:11})},restoreTooltips:function(e){(e=void 0!==e&&e&&e.length>0?e.find(".charitable-help-tooltip"):jQuery(".charitable-help-tooltip")).each((function(){var e=jQuery(this);0!==jQuery.tooltipster.instances(this).length&&e.attr("title",e.tooltipster("content"))}))},isURL:function(e){if("string"!=typeof e)return!1;var r=e.match(/^(?:http(?:s?):)?\/\/(\S+)/);if(!r)return!1;var t=r[1];return!!t&&!(!/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/.test(t)&&!/^[^\s\.]+\.\S{2,}$/.test(t))},sanitizeHTML:function(e,r){var t=window.DOMPurify;if(void 0===t||void 0===e)return e;"string"!=typeof e&&(e=e.toString());const i={ADD_ATTR:["target"]};return void 0!==r&&(i.ALLOWED_TAGS=r),t.sanitize(e,i).trim()},encodeHTMLEntities:function(e){return"string"!=typeof e&&(e=e.toString()),e.replace(/[\u00A0-\u9999<>&]/gim,(function(e){return"&#"+e.charCodeAt(0)+";"}))},initRadioGroupForCheckboxes:function(){var $=jQuery;$(document).on("change",'input[type="checkbox"].charitable-radio-group',(function(){var e=$(this),r=e.attr("id");if(e.prop("checked")){var t,i=e.data("radio-group");$(".charitable-radio-group-"+i).each((function(){(t=$(this)).attr("id")!==r&&t.prop("checked",!1)}))}}))},listPluck:function(e,r){return e.map((function(e){return void 0!==e?e[r]:e}))},triggerEvent:function(e,r){return console.warn('WARNING! Function "wpchar.triggerEvent( $element, eventName )" has been deprecated, please use the new "CharitableUtils.triggerEvent( $element, eventName, args )" function instead!'),CharitableUtils.triggerEvent(e,r)},wpautop:function(e,r=!0){let t=new Map,i=function(e){return e[0].replace("\n","<WPPreserveNewline />")};if("string"!=typeof e&&!(e instanceof String))return e;if(""===e.trim())return"";if((e+="\n").indexOf("<pre")>-1){let r=e.split("</pre>"),i=r.pop();e="",r.forEach((function(r,i){const a=r.indexOf("<pre");if(-1===a)return void(e+=r);let n="<pre wp-pre-tag-"+i+"></pre>";t[n]=r.substring(a)+"</pre>",e+=r.substring(0,a)+n})),e+=i}let a="(?:table|thead|tfoot|caption|col|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|form|map|area|blockquote|address|math|style|p|h[1-6]|hr|fieldset|legend|section|article|aside|hgroup|header|footer|nav|figure|figcaption|details|menu|summary)";0===(e=(e=(e=(e=e.replace(/<br \/>\s*<br \/>/,"\n\n")).replace(new RegExp("(<"+a+"[^>]*>)","gmi"),"\n$1")).replace(new RegExp("(</"+a+">)","gmi"),"$1\n\n")).replace(/\r\n|\r/,"\n")).indexOf("\n")&&(e=e.substring(1)),e.indexOf("<option")>-1&&(e=(e=e.replace(/(?=(\s*))\2<option'/gim,"<option")).replace(/<\/option>\s*/gim,"</option>")),e.indexOf("</object>")>-1&&(e=(e=(e=e.replace(/(<object[^>]*>)\s*/gim,"$1")).replace(/(?=(\s*))\2<\/object>/gim,"</object>")).replace(/(?=(\s*))\2(<\/?(?:param|embed)[^>]*>)((?=(\s*))\2)/gim,"$1")),(e.indexOf("<source")>-1||e.indexOf("<track")>-1)&&(e=(e=(e=e.replace(/([<\[](?:audio|video)[^>\]]*[>\]])\s*/gim,"$1")).replace(/(?=(\s*))\2([<\[]\/(?:audio|video)[>\]])/gim,"$1")).replace(/(?=(\s*))\2(<(?:source|track)[^>]*>)(?=(\s*))\2/gim,"$1"));let n=(e=e.replace(/\n\n+/gim,"\n\n")).split(/\n\s*\n/);return e="",n.forEach((function(r){e+="<p>"+r.replace(/^(?:\s+|\s+)$/g,"")+"</p>\n"})),e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<p>\s*<\/p>/gim,"")).replace(/<p>([^<]+)<\/(div|address|form)>/gim,"<p>$1</p></$2>")).replace(new RegExp("<p>s*(</?"+a+"[^>]*>)s*</p>","gmi"),"$1",e)).replace(/<p>(<li.+?)<\/p>/gim,"$1")).replace(/<p><blockquote([^>]*)>/gim,"<blockquote$1><p>")).replace(/<\/blockquote><\/p>/gim,"</p></blockquote>")).replace(new RegExp("<p>s*(</?"+a+"[^>]*>)","gmi"),"$1")).replace(new RegExp("(</?"+a+"[^>]*>)s*</p>","gmi"),"$1"),r&&(e=(e=(e=e.replace(/<(script|style)(?:.|\n)*?<\/\\1>/gim,i)).replace(/(<br \/>)?((?=(\s*))\2)\n/gim,"<br />\n")).replace("<WPPreserveNewline />","\n")),e=(e=(e=e.replace(new RegExp("(</?"+a+"[^>]*>)s*<br />","gmi"),"$1")).replace(/<br \/>(\s*<\/?(?:p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)/gim,"$1")).replace(/\n<\/p>$/gim,"</p>"),Object.keys(t).length&&(e=e.replace(new RegExp(Object.keys(t).join("|"),"gi"),(function(e){return t[e]}))),e}};wpchar.init();