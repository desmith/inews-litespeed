"use strict";var Charitable=window.Charitable||{};Charitable.Admin=Charitable.Admin||{},Charitable.Admin.Builder=Charitable.Admin.Builder||{},Charitable.Admin.Builder.DragFields=Charitable.Admin.Builder.DragFields||function(e,a,$){let i,t={},d={};const r={init:function(){$(r.ready)},ready:function(){r.setup(),r.initSortableFields(),r.events()},setup:function(){t={$builder:$("#charitable-builder"),$sortableFieldsWrap:$(".charitable-panel-fields .charitable-field-wrap"),$sortableTabsWrap:$(".charitable-panel-fields .charitable-tab-wrap"),$addFieldsButtons:$(".charitable-add-fields-button").not(".not-draggable").not(".warning-modal").not(".charitable-not-available").not(".charitable-not-installed"),$preview:$(".charitable-preview")},wpchar.debug("setup drag-fields"),wpchar.debug(t,"drag-fields")},events:function(){t.$builder.on("charitableFieldDragToggle",r.fieldDragToggleEvent),t.$builder.on("charitableAddNewTab",r.initAfterNewTab)},initAfterNewTab:function(e,a=!1){wpchar.debug("groupID"),wpchar.debug(e,"drag-fields"),wpchar.debug(a,"drag-fields"),wpchar.debug(t.$sortableTabsWrap,"drag-fields"),t.$sortableTabsWrap=$(".charitable-panel-fields .charitable-tab-wrap"),wpchar.debug(t.$sortableTabsWrap,"drag-fields"),r.initSortableFields(),CharitableCampaignBuilder.setCampaignNotSaved()},disableDragAndDrop:function(){wpchar.debug("disableDragAndDrop"),t.$addFieldsButtons.filter(".ui-draggable").draggable("disable"),t.$sortableFieldsWrap.sortable("disable"),t.$sortableFieldsWrap.find(".charitable-layout-section.ui-sortable").sortable("disable")},enableDragAndDrop:function(){wpchar.debug("enableDragAndDrop"),t.$addFieldsButtons.filter(".ui-draggable").draggable("enable"),t.$sortableFieldsWrap.sortable("enable"),t.$sortableFieldsWrap.find(".charitable-layout-section.ui-sortable").sortable("enable")},fieldDragDisable:function(e,a=!0){if(e.hasClass("ui-draggable-disabled"))return void e.draggable("enable");let i;e.draggable({revert:!0,axis:"y",delay:100,opacity:.75,cursor:"move",start:function(e,a){i=a.position.top},drag:function(e,t){if(Math.abs(t.position.top)-Math.abs(i)>15)return a&&r.youCantReorderFieldPopup(),!1}})},fieldDragEnable:function(e){e.hasClass("ui-draggable")||(wpchar.debug("fieldDragEnable"),e.draggable("disable"))},youCantReorderFieldPopup:function(){$.confirm({title:charitable_builder.heads_up,content:charitable_builder.field_cannot_be_reordered,icon:"fa fa-exclamation-circle",type:"red",buttons:{confirm:{text:charitable_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},fieldDragToggleEvent:function(e,a){const i=$(`#charitable-field-${a}`);if(i.hasClass("charitable-field-not-draggable")||i.hasClass("charitable-field-stick"))return r.fieldDragDisable(i),void wpchar.debug("fieldDragToggleEvent fieldDragDisable");r.fieldDragEnable(i),CharitableCampaignBuilder.setCampaignNotSaved()},initSortableFields:function(){wpchar.debug("initSortableFields","drag-fields"),wpchar.debug(t.$sortableFieldsWrap,"drag-fields"),wpchar.debug(t.$sortableTabsWrap,"drag-fields"),r.initSortableContainer(t.$sortableTabsWrap),t.$builder.find(".charitable-panel-fields .charitable-field-wrap").each((function(){r.initSortableContainer($(this))})),r.initDraggableFields()},initSortableContainer:function(e){let a,l,n;wpchar.debug("initSortableContainer"),e.sortable({items:"> .charitable-field:not(.charitable-field-stick):not(.no-fields-preview)",connectWith:".charitable-field-wrap, .charitable-tab-wrap",delay:100,opacity:.75,cursor:"move",cancel:".charitable-field-not-draggable",placeholder:"charitable-field-drag-placeholder",appendTo:".charitable-design-wrap",zindex:1e4,tolerance:"pointer",distance:1,start:function(i,t){wpchar.debug("vars","drag-fields"),wpchar.debug(d,"drag-fields"),wpchar.debug("start sortable via drag-fields.js"),wpchar.debug("ui","drag-fields"),wpchar.debug(t,"drag-fields"),wpchar.debug("ui.item","drag-fields"),wpchar.debug(t.item,"drag-fields"),a=t.item.data("field-id"),l=t.item.data("field-type")||d.fieldType,d.section=!n&&t.item.closest(".charitable-field-section"),n=void 0===a,wpchar.debug(" fieldId: "+a+" - fieldType: "+l+" - newField: "+n+" - section: "+d.section),d.fieldReceived=!1,d.fieldRejected=!1,d.$sortableStart=e,d.fieldType=l,d.startPosition=t.item.first().index(),$(this).attr("data-previndex",t.item.index())},beforeStop:function(e,a){wpchar.debug("beforeStop ==== sortable via drag-fields.js")},stop:function(e,a){wpchar.debug("stop ==== sortable via drag-fields.js"),wpchar.debug(a,"drag-fields");const i=a.item.first();a.placeholder.removeClass("charitable-field-drag-not-allowed"),i.removeClass("charitable-field-drag-not-allowed"),i.removeClass("charitable-field-dragging").removeClass("charitable-field-drag-over").attr("style",""),t.$builder.trigger("charitableFieldMove",a)},over:function(e,t){wpchar.debug("over ==== sortable via drag-fields.js");const r=t.item.first(),o=$(e.target),s=o.find(".charitable-field-drag-placeholder"),b=o.hasClass("charitable-layout-column"),c=b?" charitable-field-drag-to-column":"",u={width:o.outerWidth(),height:r.outerHeight()};a=r.data("field-id"),l=r.data("field-type")||d.fieldType,n=void 0===a,r.addClass("charitable-field-dragging"+c).css({width:b?u.width-5:u.width,height:"auto"}),s.removeClass("charitable-field-drag-not-allowed").css({height:n?u.height+18:u.height}),!i.isFieldAllowedInColum(l)&&b&&(s.addClass("charitable-field-drag-not-allowed"),r.addClass("charitable-field-drag-not-allowed")),n&&r.addClass("charitable-field-drag-over").removeClass("charitable-field-drag-out")},out:function(e,a){wpchar.debug("out ==== sortable via drag-fields.js")},receive:function(e,a){wpchar.debug("receive ==== sortable via drag-fields.js"),wpchar.debug(a,"drag-fields"),wpchar.debug(a.helper,"drag-fields"),wpchar.debug(a.item,"drag-fields"),wpchar.debug(a.position,"drag-fields"),wpchar.debug(a.originalPosition,"drag-fields"),wpchar.debug(a.sender,"drag-fields"),wpchar.debug(a.placeholder,"drag-fields")},update:function(a,i){wpchar.debug("update ==== sortable via drag-fields.js");i.item.index(),$(this).attr("data-previndex"),i.item.attr("class");$(this).attr("data-current-index",i.item.index()),wpchar.debug($(this)),$(this).removeAttr("data-previndex");const l=$(i.helper||i.item);var n=e.hasClass("charitable-field-wrap")?"fields":"tabs",o="fields"===n&&parseInt(l.closest(".charitable-field-column").data("column-id")),s="fields"===n&&parseInt(l.closest(".charitable-field-section").data("section-id")),b="tabs"===n&&parseInt(l.closest(".tab_content_item").data("tab-id")),c=l.data("field-id"),u=l.data("field-type")||d.fieldType;const g=void 0===c,f=e.hasClass("charitable-layout-column"),h=t.$preview.find(".charitable-field.charitable-field-donate-button").length,p=t.$preview.find(".charitable-field.charitable-field-donation-form").length;wpchar.debug(e),wpchar.debug(e.data("ui-sortable")),wpchar.debug(e.data("ui-sortable").currentItem);var m=$(this).attr("data-current-index");wpchar.debug(m,"currentIndex"),wpchar.debug($(this));let w=void 0===m?-1:m;t.$builder.find(".charitable-add-fields .charitable-add-fields-button").prop("disabled",!0),"donation-form"===u?h>0?($(".ui-draggable-dragging").css("opacity","0"),$.confirm({title:charitable_builder.heads_up,content:charitable_builder.donation_form_donation_button,icon:"fa fa-exclamation-circle",type:"red",buttons:{confirm:{text:charitable_builder.remove_donation_button,btnClass:"btn-confirm",keys:["enter"],action:function(){t.$preview.find(".charitable-field.charitable-field-donate-button").each((function(){var e=$(this).data("field-id");parseInt(e)>0&&CharitableCampaignBuilder.fieldDelete(e,!1)})),$(".ui-draggable-dragging").css("opacity","1.0"),r.addFieldAfterDrag(l,g,f,w,n,o,b,s,c,u,e)}},cancel:{text:charitable_builder.cancel,keys:["esc"],action:function(){t.$builder.find(".charitable-add-fields .charitable-add-fields-button").prop("disabled",!1),l.remove()}}}})):p>0?($(".ui-draggable-dragging").css("opacity","0"),$.confirm({title:charitable_builder.heads_up,content:charitable_builder.only_one_donation_form,icon:"fa fa-exclamation-circle",type:"red",buttons:{confirm:{text:charitable_builder.remove_donation_form,btnClass:"btn-confirm",keys:["enter"],action:function(){t.$preview.find(".charitable-field.charitable-field-donation-form").each((function(){var e=$(this).data("field-id");parseInt(e)>0&&CharitableCampaignBuilder.fieldDelete(e,!1)})),$(".ui-draggable-dragging").css("opacity","1.0"),r.addFieldAfterDrag(l,g,f,w,n,o,b,s,c,u,e)}},cancel:{text:charitable_builder.cancel,keys:["esc"],action:function(){t.$builder.find(".charitable-add-fields .charitable-add-fields-button").prop("disabled",!1),l.remove()}}}})):(wpchar.debug("drag made it here 1"),wpchar.debug(w),r.addFieldAfterDrag(l,g,f,w,n,o,b,s,c,u,e,d.section)):"donate-button"===u&&p>0?($(".ui-draggable-dragging").css("opacity","0"),$.confirm({title:charitable_builder.heads_up,content:charitable_builder.donation_button_donation_form,icon:"fa fa-exclamation-circle",type:"red",buttons:{confirm:{text:charitable_builder.remove_donation_form,btnClass:"btn-confirm",keys:["enter"],action:function(){t.$preview.find(".charitable-field.charitable-field-donation-form").each((function(){var e=$(this).data("field-id");parseInt(e)>0&&CharitableCampaignBuilder.fieldDelete(e,!1)})),$(".ui-draggable-dragging").css("opacity","1.0"),r.addFieldAfterDrag(l,g,f,w,n,o,b,s,c,u,e,d.section)}},cancel:{text:charitable_builder.cancel,keys:["esc"],action:function(){t.$builder.find(".charitable-add-fields .charitable-add-fields-button").prop("disabled",!1),l.remove()}}}})):(wpchar.debug("drag made it here 2"),wpchar.debug(w),r.addFieldAfterDrag(l,g,f,w,n,o,b,s,c,u,e,d.section))},change:function(e,a){wpchar.debug("change ==== sortable via drag-fields.js")},sort:function(e,a){wpchar.debug("sort ==== sortable via drag-fields.js"),CharitableCampaignBuilder.setCampaignNotSaved()}})},addFieldAfterDrag(e,a,i,t,r,l,n,o,s,b,c,u){a?(e.addClass("charitable-field-drag-over charitable-field-drag-pending").removeClass("charitable-field-drag-out").append(CharitableCampaignBuilder.settings.spinnerInline).css("width","100%"),wpchar.debug("addFieldAfterDrag"),wpchar.debug(i),wpchar.debug(t),CharitableCampaignBuilder.fieldAdd(d.fieldType,{position:i?t-1:t,placeholder:e,$sortable:c,column_id:l,tab_id:n,section_id:o,area:r,section:!1})):CharitableCampaignBuilder.fieldMove(d.fieldType,{field:e,fieldId:s,$sortable:c,column_id:l,tab_id:n,section_id:o,area:r,section:u}),CharitableCampaignBuilder.setCampaignNotSaved()},getChildIndex(e){for(var a=e.parent().children(),i=0;i<a.length;i++)if(a[i]===e[0])return i+1;return-1},initDraggableFields:function(){t.$addFieldsButtons.draggable({connectToSortable:".charitable-field-wrap, .charitable-tab-wrap",delay:200,cancel:!1,scroll:!1,opacity:.75,appendTo:".charitable-design-wrap",zindex:1e4,helper:function(){let e=$(this),a=$('<div class="charitable-field-drag-out charitable-field-drag">');return d.fieldType=e.data("field-type"),wpchar.debug("initDraggableFields start "),wpchar.debug(d,"drag-fields"),wpchar.debug(a.html(e.html(),"drag-fields")),wpchar.debug("initDraggableFields end"),a.html(e.html())},start:function(e,a){if(CharitableUtils.triggerEvent(t.$builder,"charitableFieldAddDragStart",[d.fieldType,a]).isDefaultPrevented())return!1}})},revertMoveFieldToColumn:function(e){if(void 0===e.data("field-id"))return void e.remove();e=e.detach();const a=d.$sortableStart.find("> .charitable-field").eq(d.startPosition);e.removeClass("charitable-field-dragging").removeClass("charitable-field-drag-over").attr("style",""),a.length?a.before(e):d.$sortableStart.append(e)}};return i={positionFieldInColumn:function(e,a,i){Charitable.Admin.Builder.FieldLayout&&Charitable.Admin.Builder.FieldLayout.positionFieldInColumn(e,a,i)},receiveFieldToColumn:function(e,a,i){Charitable.Admin.Builder.FieldLayout&&Charitable.Admin.Builder.FieldLayout.receiveFieldToColumn(e,a,i)},fieldOptionsUpdate:function(e,a){Charitable.Admin.Builder.FieldLayout&&Charitable.Admin.Builder.FieldLayout.fieldOptionsUpdate(e,a)},reorderLayoutFieldsOptions:function(e){Charitable.Admin.Builder.FieldLayout&&Charitable.Admin.Builder.FieldLayout.reorderLayoutFieldsOptions(e)},isFieldAllowedInColum:function(e){return!Charitable.Admin.Builder.FieldLayout||Charitable.Admin.Builder.FieldLayout.isFieldAllowedInColum(e)}},r}(document,window,jQuery),Charitable.Admin.Builder.DragFields.init();